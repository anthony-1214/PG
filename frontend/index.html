<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SmartMeal - Login</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="nav">
    <div class="nav-inner">
      <div class="brand">ğŸœ SmartMeal <span class="badge">MongoDB Atlas â€¢ Render-ready</span></div>
      <div class="nav-links">
        <a href="menu.html">Menu</a>
        <a href="orders.html">My Orders</a>
        <a href="vendor.html">Vendor</a>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <div class="card">
        <h2>ç™»å…¥ / Login</h2>
        <p class="sub">è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ç™»å…¥å¾Œï¼Œå­¸ç”Ÿå¯é»é¤ï¼›åº—å®¶å¯ç®¡ç†è¨‚å–®ç‹€æ…‹ã€‚</p>

        <div class="row">
          <div class="field">
            <label>Email</label>
            <input id="loginEmail" placeholder="you@example.com"/>
          </div>
          <div class="field">
            <label>Password</label>
            <input id="loginPw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
          </div>
          <div>
            <label style="opacity:0">.</label>
            <button class="btn primary" onclick="doLogin()">Login</button>
          </div>
        </div>

        <div id="loginMsg" class="toast"></div>

        <div class="hr"></div>

        <h2>è¨»å†Š / Register</h2>
        <p class="sub">Demo ç”¨ï¼šå¯å»ºç«‹å­¸ç”Ÿå¸³è™Ÿæˆ–åº—å®¶å¸³è™Ÿï¼ˆrole=vendorï¼‰ã€‚</p>

        <div class="row">
          <div class="field">
            <label>Name</label>
            <input id="regName" placeholder="Anthony"/>
          </div>
          <div class="field">
            <label>Email</label>
            <input id="regEmail" placeholder="new@example.com"/>
          </div>
          <div class="field">
            <label>Password</label>
            <input id="regPw" type="password" placeholder="è‡³å°‘ 6 ç¢¼"/>
          </div>
          <div class="field">
            <label>Role</label>
            <select id="regRole">
              <option value="student">student</option>
              <option value="vendor">vendor</option>
            </select>
          </div>
          <div>
            <label style="opacity:0">.</label>
            <button class="btn success" onclick="doRegister()">Create</button>
          </div>
        </div>

        <div id="regMsg" class="toast"></div>

        <div class="footer">
          âœ… å»ºè­° Demoï¼šå…ˆå»ºç«‹ student ä¸‹å–®ï¼Œå†ç”¨ vendor ç™»å…¥åˆ° Vendor é æ”¹ READYã€‚
        </div>
      </div>

      <div class="card">
        <h2>å¿«é€Ÿå°è¦½</h2>
        <p class="sub">ä½ å¯ä»¥ç”¨ä¸‹é¢é †åºéŒ„ 10 åˆ†é˜ Demoã€‚</p>

        <ol class="sub" style="margin:0;padding-left:18px">
          <li>ï¼ˆä¸€æ¬¡ï¼‰å…ˆåˆ° Menu é é» <span class="kbd">Seed sample menu</span></li>
          <li>ç”¨ student ç™»å…¥ â†’ é»é¤ â†’ Place Order</li>
          <li>ç”¨ vendor ç™»å…¥ â†’ Vendor é  â†’ æ”¹ READY</li>
          <li>å› My Orders æª¢æŸ¥ç‹€æ…‹</li>
        </ol>

        <div class="hr"></div>

        <button class="btn danger" onclick="logout()">Logout (clear token)</button>
        <div class="footer">å¦‚æœç‹€æ…‹æ€ªæ€ªçš„ï¼Œå…ˆæŒ‰ Logout æ¸… tokenï¼Œå†é‡ç™»å…¥ã€‚</div>
      </div>
    </div>
  </div>

  <script src="api.js"></script>
  <script>
    async function doLogin(){
      loginMsg.textContent = "Logging in...";
      try{
        const res = await api("/login", "POST", { email: loginEmail.value, password: loginPw.value });
        setAuth(res.token, res.user?.role);
        localStorage.setItem("user", JSON.stringify(res.user || {}));
        loginMsg.textContent = "âœ… Login success! Redirecting to menu...";
        setTimeout(()=>window.location="menu.html", 500);
      }catch(e){
        loginMsg.textContent = "âŒ " + e.message;
      }
    }

    async function doRegister(){
      regMsg.textContent = "Creating account...";
      try{
        const res = await api("/register", "POST", {
          name: regName.value,
          email: regEmail.value,
          password: regPw.value,
          role: regRole.value
        });
        setAuth(res.token, res.user?.role);
        localStorage.setItem("user", JSON.stringify(res.user || {}));
        regMsg.textContent = "âœ… Register success! Redirecting to menu...";
        setTimeout(()=>window.location="menu.html", 500);
      }catch(e){
        regMsg.textContent = "âŒ " + e.message;
      }
    }
  </script>
</body>
</html>